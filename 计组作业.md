### 5.10.1  
  
P1: 1.52 GHz  
P2: 1.11 GHz  

---
### 5.10.2  

**P1:**
主存访问的周期数：$70 / 0.66 = 107$
平均内存访问的周期数：$1+ 0.08 * 107 = 9.56$
**P2:**    
主存访问的周期数：$70 / 0.9 = 78$
平均内存访问的周期数：$1+ 0.06 * 78 = 5.68$

---
### 5.10.3  

**P1:**    
$CPI=1 + 0.08 \times 107 + 0.36 \times 0.08 \times 107 = 12.64$  
每条指令需要的时间=$12.64 \times 0.66 = 8.34ns$  

**P2:**  
$CPI=1 + 0.06 \times 78 + 0.36 \times 0.06 \times 78 = 7.36$  
每条指令需要的时间=$7.36 \times 0.9 = 6.63ns$  
  
故P2更快 

---
### 5.10.4  
  
L2的访问需要的周期数=$5.62 / 0.66 = 9$  
  
总平均内存访问的周期数=$1 + 0.08 \times (9 + 0.95 \times 107) = 9.85$
  
故AMAT变差
  
---
### 5.10.5  
  
$CPI=1 + 0.08 \times (9 + 0.95 \times 107) + 0.36 \times 0.08 \times (9 + 0.95 \times 107) = 13.04$  

---
### 5.10.6  
设失效率为r

$9.56\gt 1 + 0.08 \times (9 + 107r)$  
$r \lt 0.916$  
  
即失效率要小于0.916 

---
### 5.10.7  
  
$CPI_{p1} \times 0.66 \lt 6.63$ 
$CPI_{p1} \lt 10.05$  
  
$1+0.08[9+r\times107]<7.65$
$r \lt 0.693$  
  
即失效率要小于0.693 
  
## 5.11  
  
### 5.11.2  
  
|  Word Address  |   Binary   | Tag  | Index  | Offset  | H/M   |                             Way 0                             |          Way 1          |   Way 2    |     |
| :------------: | :--------: | :--: | :----: | :-----: | :---: | :-----------------------------------------------------------: | :---------------------: | :--------: | --- |
|      0x03      | 0000 0011  | 0x0  |    1   |    1    |   M   |                            T(1) = 0                           |                         |            |     |
|      0xb4      | 1011 0100  | 0xb  |    2   |    0    |   M   |                      T(1) = 0<br>T(2) = b                     |                         |            |     |
|      0x2b      | 0010 1011  | 0x2  |    5   |    1    |   M   |                T(1) = 0<br>T(2) = b<br>T(5) = 2               |                         |            |     |
|      0x02      | 0000 0010  | 0x0  |    1   |    0    |   H   |               T(1) = 0<br/>T(2) = b<br/>T(5) = 2              |                         |            |     |
|      0xbe      | 1011 1110  | 0xb  |    7   |    0    |   M   |         T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br>T(7) = b        |                         |            |     |
|      0x58      | 0101 1000  | 0x5  |    4   |    0    |   M   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br>T(4) = 5   |                         |            |     |
|      0xbf      | 1011 1111  | 0xb  |    7   |    1    |   H   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |                         |            |     |
|      0x0e      | 0000 1110  | 0x0  |    7   |    0    |   M   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |        T(7) = 0         |            |     |
|      0x1f      | 0001 1111  | 0x1  |    7   |    1    |   M   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |        T(7) = 0         |  T(7) = 1  |     |
|      0xb5      | 1011 0101  | 0xb  |    2   |    1    |   H   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |        T(7) = 0         |  T(7) = 1  |     |
|      0xbf      | 1011 1111  | 0xb  |    7   |    1    |   H   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |        T(7) = 0         |  T(7) = 1  |     |
|      0xba      | 1011 1010  | 0xb  |    5   |    0    |   M   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |  T(7) = 0<br>T(5) = b   |  T(7) = 1  |     |
|      0x2e      | 0010 1110  | 0x2  |    7   |    0    |   M   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |  T(7) = 2<br/>T(5) = b  |  T(7) = 1  |     |
|      0xce      | 1100 1110  | 0xc  |    7   |    0    |   M   | T(1) = 0<br/>T(2) = b<br/>T(5) = 2<br/>T(7) = b<br/>T(4) = 5  |  T(7) = 2<br/>T(5) = b  |  T(7) = c  |     |
  
  
  
### 5.11.4  
  
| Word Address  |   Binary   | Tag  | H/M   |         Contents         |     |
| :-----------: | :--------: | :--: | :---: | :----------------------: | --- |
|      0x03     | 0000 0011  | 0x03 |   M   |            03            |     |
|      0xb4     | 1011 0100  | 0xb4 |   M   |           03,b4          |     |
|      0x2b     | 0010 1011  | 0x2b |   M   |         03,b4,2b         |     |
|      0x02     | 0000 0010  | 0x02 |   M   |        03,b4,2b,02       |     |
|      0xbe     | 1011 1110  | 0xbe |   M   |      03,b4,2b,02,be      |     |
|      0x58     | 0101 1000  | 0x58 |   M   |     03,b4,2b,02,be,58    |     |
|      0xbf     | 1011 1111  | 0xbf |   M   |   03,b4,2b,02,be,58,bf   |     |
|      0x0e     | 0000 1110  | 0x0e |   M   | 03,b4,2b,02,be,58,bf,0e  |     |
|      0x1f     | 0001 1111  | 0x1f |   M   | b4,2b,02,be,58,bf,0e,1f  |     |
|      0xb5     | 1011 0101  | 0xb5 |   M   | 2b,02,be,58,bf,0e,1f,b5  |     |
|      0xbf     | 1011 1111  | 0xbf |   H   | 2b,02,be,58,0e,1f,b5,bf  |     |
|      0xba     | 1011 1010  | 0xba |   M   | 02,be,58,0e,1f,b5,bf,ba  |     |
|      0x2e     | 0010 1110  | 0x2e |   M   | be,58,0e,1f,b5,bf,ba,2e  |     |
|      0xce     | 1100 1110  | 0xce |   M   | 58,0e,1f,b5,bf,ba,2e,ce  |     |
  
  
  
### 5.11.6  
  
| Word Address |  Binary   | Tag  | Offset | H/M  |            Contents             |  
| :----------: | :-------: | :--: | :----: | :--: | :-----------------------------: |  
|     0x03     | 0000 0011 | 0x01 |   1    |  M   |             [02,03]             |  
|     0xb4     | 1011 0100 | 0x5a |   0    |  M   |         [02,03],[b4,b5]         |  
|     0x2b     | 0010 1011 | 0x15 |   1    |  M   |     [02,03],[b4,b5],[2a,2b]     |  
|     0x02     | 0000 0010 | 0x01 |   0    |  H   |     [b4,b5],[2a,2b],[02,03]     |  
|     0xbe     | 1011 1110 | 0x5f |   0    |  M   | [b4,b5],[2a,2b],[02,03],[be,bf] |  
|     0x58     | 0101 1000 | 0x2c |   0    |  M   | [2a,2b],[02,03],[be,bf],[58,59] |  
|     0xbf     | 1011 1111 | 0x5f |   1    |  H   | [2a,2b],[02,03],[58,59],[be,bf] |  
|     0x0e     | 0000 1110 | 0x07 |   0    |  M   | [02,03],[58,59],[be,bf],[0e,0f] |  
|     0x1f     | 0001 1111 | 0x0f |   1    |  M   | [58,59],[be,bf],[0e,0f],[1e,1f] |  
|     0xb5     | 1011 0101 | 0x5a |   1    |  M   | [be,bf],[0e,0f],[1e,1f],[b4,b5] |  
|     0xbf     | 1011 1111 | 0x5f |   1    |  H   | [0e,0f],[1e,1f],[b4,b5],[be,bf] |  
|     0xba     | 1011 1010 | 0x5d |   0    |  M   | [1e,1f],[b4,b5],[be,bf],[ba,bb] |  
|     0x2e     | 0010 1110 | 0x17 |   0    |  M   | [b4,b5],[be,bf],[ba,bb],[2e,2f] |  
|     0xce     | 1100 1110 | 0x67 |   0    |  M   | [be,bf],[ba,bb],[2e,2f],[ce,cf] |  
  
### 5.11.7  
  
| Word Address |  Binary   | Tag  | Offset | H/M  |            Contents             |  
| :----------: | :-------: | :--: | :----: | :--: | :-----------------------------: |  
|     0x03     | 0000 0011 | 0x01 |   1    |  M   |             [02,03]             |  
|     0xb4     | 1011 0100 | 0x5a |   0    |  M   |         [02,03],[b4,b5]         |  
|     0x2b     | 0010 1011 | 0x15 |   1    |  M   |     [02,03],[b4,b5],[2a,2b]     |  
|     0x02     | 0000 0010 | 0x01 |   0    |  H   |     [b4,b5],[2a,2b],[02,03]     |  
|     0xbe     | 1011 1110 | 0x5f |   0    |  M   | [b4,b5],[2a,2b],[02,03],[be,bf] |  
|     0x58     | 0101 1000 | 0x2c |   0    |  M   | [b4,b5],[2a,2b],[02,03],[58,59] |  
|     0xbf     | 1011 1111 | 0x5f |   1    |  M   | [b4,b5],[2a,2b],[02,03],[be,bf] |  
|     0x0e     | 0000 1110 | 0x07 |   0    |  M   | [b4,b5],[2a,2b],[02,03],[0e,0f] |  
|     0x1f     | 0001 1111 | 0x0f |   1    |  M   | [b4,b5],[2a,2b],[02,03],[1e,1f] |  
|     0xb5     | 1011 0101 | 0x5a |   1    |  H   | [2a,2b],[02,03],[1e,1f],[b4,b5] |  
|     0xbf     | 1011 1111 | 0x5f |   1    |  M   | [2a,2b],[02,03],[1e,1f],[be,bf] |  
|     0xba     | 1011 1010 | 0x5d |   0    |  M   | [2a,2b],[02,03],[1e,1f],[ba,bb] |  
|     0x2e     | 0010 1110 | 0x17 |   0    |  M   | [2a,2b],[02,03],[1e,1f],[2e,2f] |  
|     0xce     | 1100 1110 | 0x67 |   0    |  M   | [2a,2b],[02,03],[1e,1f],[ce,cf] |  
  
### 5.11.8  
  
| Word Address |  Binary   | Tag  | Offset | H/M  |            Contents             |  
| :----------: | :-------: | :--: | :----: | :--: | :-----------------------------: |  
|     0x03     | 0000 0011 | 0x01 |   1    |  M   |             [02,03]             |  
|     0xb4     | 1011 0100 | 0x5a |   0    |  M   |         [02,03],[b4,b5]         |  
|     0x2b     | 0010 1011 | 0x15 |   1    |  M   |     [02,03],[b4,b5],[2a,2b]     |  
|     0x02     | 0000 0010 | 0x01 |   0    |  H   |     [02,03],[b4,b5],[2a,2b]     |  
|     0xbe     | 1011 1110 | 0x5f |   0    |  M   | [02,03],[b4,b5],[2a,2b],[be,bf] |  
|     0x58     | 0101 1000 | 0x2c |   0    |  M   | [58,59],[b4,b5],[2a,2b],[be,bf] |  
|     0xbf     | 1011 1111 | 0x5f |   1    |  H   | [58,59],[b4,b5],[2a,2b],[be,bf] |  
|     0x0e     | 0000 1110 | 0x07 |   0    |  M   | [0e,0f],[b4,b5],[2a,2b],[be,bf] |  
|     0x1f     | 0001 1111 | 0x0f |   1    |  M   | [1e,1f],[b4,b5],[2a,2b],[be,bf] |  
|     0xb5     | 1011 0101 | 0x5a |   1    |  H   | [1e,1f],[b4,b5],[2a,2b],[be,bf] |  
|     0xbf     | 1011 1111 | 0x5f |   1    |  H   | [1e,1f],[b4,b5],[2a,2b],[be,bf] |  
|     0xba     | 1011 1010 | 0x5d |   0    |  M   | [1e,1f],[b4,b5],[2a,2b],[ba,bb] |  
|     0x2e     | 0010 1110 | 0x17 |   0    |  M   | [1e,1f],[b4,b5],[2a,2b],[2e,2f] |  
|     0xce     | 1100 1110 | 0x67 |   0    |  M   | [1e,1f],[b4,b5],[2a,2b],[ce,cf] |  
  
## 5.16  
  
### 5.16.1  
  
| Address | Virtual Page | TLB H/M | PT H/M | PF Y/N |        Valid        |        Tag         |     Physical Page     |     |
| :-----: | :----------: | :-----: | :----: | :----: | :-----------------: | :----------------: | :-------------------: | --- |
| 0x123d  |      1       |    M    |   H    |   Y    |  1<br>1<br>1<br>1   |  1<br>7<br>3<br>b  |  13<br>4<br>6<br>12   |     |
| 0x08b3  |      0       |    M    |   H    |   N    |  1<br>1<br>1<br>1   | 0<br>1<br/>7<br/>3 |  5<br>13<br/>4<br/>6  |     |
| 0x365c  |      3       |    H    |   H    |   N    |  1<br>1<br>1<br>1   | 3<br>0<br/>1<br/>7 |  6<br>5<br/>13<br/>4  |     |
| 0x871b  |      8       |    M    |   H    |   Y    | 1<br/>1<br/>1<br/>1 | 8<br>3<br/>0<br/>1 | 14<br>6<br/>5<br/>13  |     |
| 0xbee6  |      b       |    M    |   H    |   N    | 1<br/>1<br/>1<br/>1 | b<br>8<br/>3<br/>0 | 12<br>14<br/>6<br/>5  |     |
| 0x3140  |      3       |    H    |   H    |   N    | 1<br/>1<br/>1<br/>1 | 3<br>b<br/>8<br/>0 | 6<br>12<br/>14<br/>5  |     |
| 0xc040  |      c       |    M    |   M    |   Y    | 1<br/>1<br/>1<br/>1 | c<br>3<br/>b<br/>8 | 15<br>6<br/>12<br/>14 |     |
### 5.16.2  
  
| Address | Virtual Page | TLB H/M | PT H/M | PF Y/N |        Valid        |         Tag         |    Physical Page     |  
| :-----: | :----------: | :-----: | :----: | :----: | :-----------------: | :-----------------: | :------------------: |  
| 0x123d  |      0       |    M    |   H    |   N    |  1<br>1<br>1<br>1   |  0<br>7<br>3<br>b   |  5<br>4<br>6<br>12   |  
| 0x08b3  |      0       |    H    |   H    |   N    |  1<br>1<br>1<br>1   | 0<br/>7<br/>3<br/>b | 5<br/>4<br/>6<br/>12 |  
| 0x365c  |      0       |    H    |   H    |   N    |  1<br>1<br>1<br>1   | 0<br/>7<br/>3<br/>b | 5<br/>4<br/>6<br/>12 |  
| 0x871b  |      2       |    M    |   H    |   Y    | 1<br/>1<br/>1<br/>1 | 2<br>0<br/>7<br/>3  | 13<br>5<br/>4<br/>6  |  
| 0xbee6  |      2       |    H    |   H    |   N    | 1<br/>1<br/>1<br/>1 | 2<br/>0<br/>7<br/>3 | 13<br/>5<br/>4<br/>6 |  
| 0x3140  |      0       |    H    |   H    |   N    | 1<br/>1<br/>1<br/>1 | 2<br/>0<br/>7<br/>3 | 13<br/>5<br/>4<br/>6 |  
| 0xc040  |      3       |    H    |   H    |   N    | 1<br/>1<br/>1<br/>1 | 2<br/>0<br/>7<br/>3 | 13<br/>5<br/>4<br/>6 |  
  
增大Page Size能提高TLB的Hit Rate，从而缩短平均内存访问时间，但较大的Page Size会导致内存利用率降低  
  
### 5.16.3  
  
| Address | Virtual Page | Index | Tag  | TLB H/M | PT H/M | PF    Y/N |      TLB INDEX      |        Valid        |         Tag         |     Physical Page     |  
| :-----: | :----------: | :---: | :--: | :-----: | :----: | :-------: | :-----------------: | :-----------------: | :-----------------: | :-------------------: |  
| 0x123d  |      1       |   1   |  0   |    M    |   H    |     Y     |  0<br>0<br>1<br>1   |  1<br>1<br>1<br>1   |  7<br>b<br>0<br>3   |  4<br>12<br>13<br>6   |  
| 0x08b3  |      0       |   0   |  0   |    M    |   H    |     N     | 0<br/>0<br/>1<br/>1 |  1<br>1<br>1<br>1   | 7<br/>0<br/>0<br/>3 | 4<br/>5<br/>13<br/>6  |  
| 0x365c  |      3       |   1   |  1   |    M    |   H    |     N     | 0<br/>0<br/>1<br/>1 |  1<br>1<br>1<br>1   | 7<br/>0<br/>1<br>0  |  4<br/>5<br/>6<br>13  |  
| 0x871b  |      8       |   0   |  4   |    M    |   H    |     Y     | 0<br/>0<br/>1<br/>1 | 1<br/>1<br/>1<br/>1 | 4<br>7<br/>1<br/>0  | 14<br>4<br/>6<br/>13  |  
| 0xbee6  |      b       |   1   |  5   |    M    |   H    |     N     | 0<br/>0<br/>1<br/>1 | 1<br/>1<br/>1<br/>1 | 4<br/>7<br/>5<br>1  | 14<br/>4<br/>12<br>6  |  
| 0x3140  |      3       |   1   |  1   |    H    |   H    |     N     | 0<br/>0<br/>1<br/>1 | 1<br/>1<br/>1<br/>1 | 4<br/>7<br/>3<br>5  | 14<br/>4<br/>6<br>12  |  
| 0xc040  |      c       |   0   |  6   |    M    |   M    |     Y     | 0<br/>0<br/>1<br/>1 | 1<br/>1<br/>1<br/>1 | 6<br>4<br/>3<br/>5  | 15<br>14<br/>6<br/>12 |  
  
### 5.16.4  
  
| Address | Virtual Page | Index | Tag  | TLB H/M | PT H/M | PF    Y/N |      TLB INDEX      |        Valid        |         Tag         |     Physical Page      |  
| :-----: | :----------: | :---: | :--: | :-----: | :----: | :-------: | :-----------------: | :-----------------: | :-----------------: | :--------------------: |  
| 0x123d  |      1       |   1   |  0   |    M    |   H    |     Y     |  0<br>1<br>2<br>3   |  1<br>1<br>1<br>0   |  b<br>0<br>3<br>4   |   12<br>13<br>6<br>9   |  
| 0x08b3  |      0       |   0   |  0   |    M    |   H    |     N     | 0<br/>1<br/>2<br/>3 |  1<br>1<br>1<br>0   | 0<br/>0<br/>3<br/>4 |  5<br/>13<br/>6<br/>9  |  
| 0x365c  |      3       |   3   |  0   |    M    |   H    |     N     | 0<br/>1<br/>2<br/>3 |  1<br>1<br>1<br>1   | 0<br/>0<br/>3<br/>0 |  5<br/>13<br/>6<br/>6  |  
| 0x871b  |      8       |   0   |  2   |    M    |   H    |     Y     | 0<br/>1<br/>2<br/>3 | 1<br/>1<br/>1<br/>1 | 2<br/>0<br/>3<br/>0 | 14<br/>13<br/>6<br/>6  |  
| 0xbee6  |      b       |   3   |  2   |    M    |   H    |     N     | 0<br/>1<br/>2<br/>3 | 1<br/>1<br/>1<br/>1 | 2<br/>0<br/>3<br/>2 | 14<br/>13<br/>6<br/>12 |  
| 0x3140  |      3       |   3   |  0   |    M    |   H    |     N     | 0<br/>1<br/>2<br/>3 | 1<br/>1<br/>1<br/>1 | 2<br/>0<br/>3<br/>0 | 14<br/>13<br/>6<br/>6  |  
| 0xc040  |      c       |   0   |  3   |    M    |   M    |     Y     | 0<br/>1<br/>2<br/>3 | 1<br/>1<br/>1<br/>1 | 3<br/>0<br/>3<br/>0 | 15<br/>13<br/>6<br/>6  |  
  
### 5.16.5  
没有TLB时，虚拟内存访问可以通过直接访问页表完成，但性能会显著下降，尤其是在多级页表结构中。TLB通过缓存页表项大幅减少地址翻译的开销，避免了每次内存访问都需要查询内存中的页表。

## 5.18  
  
### 5.18.1  
需要$2^{31}$页表项
需要$2^{43-12} \times 4 = 8$GB的物理内存
  
### 5.18.2  
需要2级的页表
内存访问次数与页表级数相同
  
### 5.18.3  
  
足以容纳：
因为每一项能表示$2^{31} \times 4KiB=8TiB>16GB$ 
  
### 5.18.4  
  $log_21024=10$
$(43-12) / 10 = 4$级
  
### 5.18.5  
  
需要$(16 × 2^{30}) / 2^{12} = 16 × 2^{18}=2^{22}$ 个PTE 
  
常见情况：2次
最坏情况：访问所有项